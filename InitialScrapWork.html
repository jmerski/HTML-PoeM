<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2D Side Scroller</title>
    <style>
        canvas { background: #eee; display: block; margin: 0 auto; }

        /* CSS for rotating the sword */
        .sword-attack {
            position: absolute;
            width: 500px; /* Adjust the size as needed */
            height: 500px; /* Adjust the size as needed */
        }

        @keyframes swing-right {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(30deg); }
            50% { transform: rotate(60deg); }
            75% { transform: rotate(90deg); }
            100% { transform: rotate(120deg); }
        }

        @keyframes swing-left {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-30deg); }
            50% { transform: rotate(-60deg); }
            75% { transform: rotate(-90deg); }
            100% { transform: rotate(-120deg); }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1600" height="800"></canvas>
    <img id="sword" src="art/croppedsword.png" style="display: none;" />

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let character = {
            x: 50,
            y: 350,
            width: 300, // Adjusted to match the pixel art size
            height: 300, // Adjusted to match the pixel art size
            dx: 0,
            dy: 0,
            speed: 5,
            jumpPower: 12,
            isJumping: false,
            doubleJump: false,
            gravity: 0.5,
            facingRight: true // Track the direction the character is facing
        };

        let keys = {};
        let characterImage = new Image();
        characterImage.src = "art/charnosword.png"; // Replace with the correct path to your pixel art image

        // Ensure the image is loaded before drawing
        characterImage.onload = function() {
            function drawCharacter() {
                ctx.save(); // Save the current canvas state
                if (!character.facingRight) {
                    ctx.scale(-1, 1); // Flip horizontally
                    ctx.drawImage(characterImage, -character.x - character.width, character.y, character.width, character.height);
                } else {
                    ctx.drawImage(characterImage, character.x, character.y, character.width, character.height);
                }
                ctx.restore(); // Restore the canvas state
            }

            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            function update() {
                clearCanvas();
                moveCharacter();
                applyGravity();
                drawCharacter();
                requestAnimationFrame(update);
            }

            function moveCharacter() {
                if (keys['ArrowLeft']) {
                    character.dx = -character.speed;
                    character.facingRight = false; // Update direction
                }
                if (keys['ArrowRight']) {
                    character.dx = character.speed;
                    character.facingRight = true; // Update direction
                }
                if (!keys['ArrowLeft'] && !keys['ArrowRight']) {
                    character.dx = 0;
                }
                character.x += character.dx;

                if (keys['ArrowUp'] && !character.isJumping) {
                    character.dy = -character.jumpPower;
                    character.isJumping = true;
                } else if (keys['ArrowUp'] && character.isJumping && !character.doubleJump) {
                    character.dy = -character.jumpPower;
                    character.doubleJump = true;
                }

                if (keys['a']) {
                    console.log("A key pressed");
                    let sword = document.getElementById("sword");

                    // Load the image to get its natural dimensions
                    let swordImage = new Image();
                    swordImage.src = "art/croppedsword.png"; // Replace with the correct path to your sword image

                    swordImage.onload = function() {
                        // Set the sword's width and height to the image's natural dimensions
                        sword.style.width = 20;
                        sword.style.height = 50;

                        // Make the sword visible and position it
                        sword.style.display = "block";
                        sword.style.position = "absolute";
                        if (character.facingRight) {
                            sword.style.left = (character.x + character.width + canvas.offsetLeft - 50) + "px"; // Adjusted for right-facing
                            sword.style.animation = "swing-right 0.5s forwards";    
                        } else {
                            sword.style.left = (character.x - swordImage.naturalWidth + canvas.offsetLeft + 50) + "px"; // Adjusted for left-facing
                            sword.style.animation = "swing-left 0.5s forwards";
                        }
                        sword.style.top = (character.y + canvas.offsetTop + (character.height / 2) - (swordImage.naturalHeight / 2)) + "px"; // Centering the sword vertically

                        setTimeout(() => {
                            sword.style.display = "none";
                        }, 500);
                    };
                }
            }

            function applyGravity() {
                character.dy += character.gravity;
                character.y += character.dy;
                if (character.y + character.height > canvas.height) {
                    character.y = canvas.height - character.height;
                    character.dy = 0;
                    character.isJumping = false;
                    character.doubleJump = false;
                }
            }

            document.addEventListener('keydown', function(event) {
                keys[event.key] = true;
            });

            document.addEventListener('keyup', function(event) {
                keys[event.key] = false;
            });

            update();
        };
    </script>
</body>
</html>
